<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-ajax.html">ajax</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ajax.html#.ajax">ajax</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ajax.html#.del">del</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ajax.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ajax.html#.post">post</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ajax.html#.put">put</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-ATV.html">ATV</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ATV.html#.reload">reload</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ATV.html#.start">start</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-handler.html">handler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-handler.html#.addAll">addAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-handler.html#.addListeners">addListeners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-handler.html#.removeAll">removeAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-handler.html#.removeListeners">removeListeners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-handler.html#.setOptions">setOptions</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-menu.html">menu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.getErrorMessage">getErrorMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.getLoadingMessage">getLoadingMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.setDocument">setDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.setOptions">setOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-menu.html#.setSelectedItem">setSelectedItem</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-navigation.html">navigation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.back">back</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.dismissModal">dismissModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.getErrorDoc">getErrorDoc</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.getLoaderDoc">getLoaderDoc</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.navigate">navigate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.navigateToMenuPage">navigateToMenuPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.pop">pop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.presentModal">presentModal</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.removeActiveDocument">removeActiveDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.replaceDocument">replaceDocument</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.setOptions">setOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.showError">showError</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-navigation.html#.showLoading">showLoading</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-page.html">page</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-page.html#.create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-page.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-page.html#.makeDom">makeDom</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-page.html#.prepareDom">prepareDom</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-page.html#.setOptions">setOptions</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-parser.html">parser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-parser.html#.dom">dom</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-settings.html">settings</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-settings.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-settings.html#.remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-settings.html#.set">set</a></span></li><li class="nav-heading">Externals</li><li class="nav-heading"><span class="nav-item-type type-external">E</span><span class="nav-item-name"><a href="external-LZString.html">LZString</a></span></li><li class="nav-heading"><span class="nav-item-type type-external">E</span><span class="nav-item-name"><a href="external-pubsub-js.html">pubsub-js</a></span></li><li class="nav-heading"><span class="nav-item-type type-external">E</span><span class="nav-item-name"><a href="external-Settings.html">Settings</a></span></li><li class="nav-heading">Events</li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onError">onError</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onExit">onExit</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onLaunch">onLaunch</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onReload">onReload</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onResume">onResume</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="global.html#event:onSuspend">onSuspend</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// external libraries
import 'babel-polyfill';
import _ from 'lodash';
import PubSub from 'pubsub-js';
import LZString from 'lz-string';

// internal libraries
import Parser from './parser';
import Ajax from './ajax';
import Page from './page';
import Navigation from './navigation';
import Handler from './handler';
import Settings from './settings';
import Menu from './menu';

// all supported configurations for each of the libraries
const configMap = {
	Ajax: [],
	Parser: [],
	Page: ['style'],
	Navigation: ['menu', 'templates'],
	Handler: ['handlers'],
};

// indicate whether the application was started
let started = false;

// all libraries
let libs = {
    /**
     * Internal alias to [lodash]{@link https://github.com/lodash/lodash} library
     * @alias module:ATV._
     */
    _: _,
    /**
     * Internal alias to [lz-string compression]{@link https://github.com/pieroxy/lz-string/} library
     * @alias module:ATV.LZString
     */
    LZString: LZString,
    /**
     * Ajax wrapper using Promises
     * @alias module:ATV.Ajax
     * @type {module:ajax}
     */
    Ajax: Ajax,
    /**
     * Page level navigation methods.
     * @alias module:ATV.Navigation
     * @type {module:navigation}
     */
    Navigation: Navigation,
    /**
     * Page Creation
     * @alias module:ATV.Page
     * @type {module:page}
     */
    Page: Page,
    /**
     * A minimalistic parser wrapper using the builtin DOMParser
     * @alias module:ATV.Parser
     * @type {module:parser}
     */
    Parser: Parser,
    /**
     * Basic event handling including some default ones
     * @alias module:ATV.Handler
     * @type {module:handler}
     */
    Handler: Handler,
    /**
     * Apple TV settings object with some basic helpers
     * @alias module:ATV.Settings
     * @type {module:settings}
     */
    Settings: Settings,
    /**
     * TVML menu template creation with few utility methods
     * @alias module:ATV.Menu
     * @type {module:menu}
     */
    Menu: Menu,
    /**
     * Create a page that can be later used for navigation.
     * This is an alias of ATV.Page.create 
     * @param  {String|Object} name     Name of the page or the configuration options
     * @param  {Object} cfg             Page configuration options
     * @return {Function}               A function that returns promise upon execution
     */
    createPage: Page.create,
    /**
     * Generates a menu from the configuration object.
     * This is an alias of ATV.Menu.create 
     * @param  {Object} cfg 		Menu related configurations
     * @return {Document}     		The created menu document
     */
    createMenu: Menu.create,
    /**
     * Navigates to the provided page if it exists in the list of available pages.
     * This is an alias of ATV.Navigation.navigate 
     * @param  {String} page        Name of the previously created page.
     * @param  {Object} options     The options that will be passed on to the page during runtime.
     * @param  {Boolean} replace    Replace the previous page.
     * @return {Promise}            Returns a Promise that resolves upon successful navigation.
     */
    navigateTo: Navigation.navigate,
    /**
     * Navigates to the menu page if it exists
     * This is an alias of ATV.Navigation.navigateToMenuPage 
     * @return {Promise}      Returns a Promise that resolves upon successful navigation.
     */
    navigateToMenuPage: Navigation.navigateToMenuPage,
    /**
     * Shows a modal. Closes the previous modal before showing a new modal.
     * This is an alias of ATV.Navigation.presentModal 
     * @param  {Document|String|Object} modal       The TVML string/document representation of the modal window or a configuration object to create modal from
     * @return {Document}                           The created modal document
     */
    presentModal: Navigation.presentModal,
    /**
     * Dismisses the current modal window.
     * This is an alias of ATV.Navigation.dismissModal 
     */
    dismissModal: Navigation.dismissModal
};

/**
 * Iterates over each libraries and call setOptions with the relevant options.
 *
 * @private
 *
 * @param  {Object} cfg 	All configuration options relevant to the libraries
 */
function initLibraries(cfg = {}) {
	_.each(configMap, (keys, libName) => {
		let lib = libs[libName];
		let options = {};
		_.each(keys, (key) => options[key] = cfg[key]);
		lib.setOptions &amp;&amp; lib.setOptions(options);
	});
}

// all supported Apple TV App level handlers
const handlers = {
    /**
     * App launch event
     *
     * @event onLaunch
     * @alias module:ATV#onLaunch
     */
    onLaunch(options = {}, fn) {
        libs.launchOptions = options;
        console.log('launching application...');
        fn(options);
    },
    /**
     * App error event
     *
     * @event onError
     * @alias module:ATV#onError
     */
    onError(options = {}, fn) {
        console.log('an error occurred in the application...')
        fn(options);
    },
    /**
     * App resume event
     *
     * @event onResume
     * @alias module:ATV#onResume
     */
    onResume(options = {}, fn) {
        console.log('resuming application...');
        fn(options);
    },
    /**
     * App suspend event
     *
     * @event onSuspend
     * @alias module:ATV#onSuspend
     */
    onSuspend(options = {}, fn) {
        console.log('suspending application...');
        fn(options);
    },
    /**
     * App exit event
     *
     * @event onExit
     * @alias module:ATV#onExit
     */
    onExit(options = {}, fn) {
        console.log('exiting application...');
        fn(options);
    },
    /**
     * App reload event
     *
     * @event onReload
     * @alias module:ATV#onReload
     */
    onReload(options = {}, fn) {
        console.log('reloading application...');
        fn(options);
    }
};

/**
 * Iterates over each supported handler types and attach it on the Apple TV App object.
 *
 * @private
 *
 * @param  {Object} cfg 	All configuration options relevant to the App.
 */
function initAppHandlers (cfg = {}) {
	_.each(handlers, (handler, name) => App[name] = _.partial(handler, _, (_.isFunction(cfg[name])) ? cfg[name] : _.noop));
}

/**
 * Starts the Apple TV application after applying the relevant configuration options
 *
 * @example
 * // create your pages
 * let SearchPage = ATV.Page.create({ page configurations });
 * let HomePage = ATV.Page.create({ page configurations });
 * let MoviesPage = ATV.Page.create({ page configurations });
 * let TVShowsPage = ATV.Page.create({ page configurations });
 * let LoginPage = ATV.Page.create({ page configurations });
 *
 * // template functions
 * const loaderTpl = (data) => `&lt;document>
 *     &lt;loadingTemplate>
 *         &lt;activityIndicator>
 *             &lt;title>${data.message}&lt;/title>
 *         &lt;/activityIndicator>
 *     &lt;/loadingTemplate>
 * &lt;/document>`;
 *
 * const errorTpl = (data) => `&lt;document>
 *     &lt;descriptiveAlertTemplate>
 *           &lt;title>${data.title}&lt;/title>
 *           &lt;description>${data.message}&lt;/description>
 *       &lt;/descriptiveAlertTemplate>
 *   &lt;/document>`;
 *
 * // Global TVML styles
 * let globalStyles = `
 * .text-bold {
 *     font-weight: bold;
 * }
 * .text-white {
 *     color: rgb(255, 255, 255);
 * }
 * .dark-background-color {
 *     background-color: #091a2a;
 * }
 * .button {
 *     background-color: rgba(0, 0, 0, 0.1);
 *     tv-tint-color: rgba(0, 0, 0, 0.1);
 * }
 * `;
 *
 * // start your application by passing configurations
 * ATV.start({
 *     style: globalStyles,
 *     menu: {
 *         attributes: {},
 *         items: [{
 *             id: 'search',
 *             name: 'Search',
 *             page: SearchPage
 *         }, {
 *             id: 'homepage',
 *             name: 'Home',
 *             page: HomePage,
 *             attributes: {
 *                 autoHighlight: true // auto highlight on navigate
 *             }
 *         }, {
 *             id: 'movies',
 *             name: 'Movies',
 *             page: MoviesPage
 *         }, {
 *             id: 'tvshows',
 *             name: 'TV Shows',
 *             page: TVShowsPage
 *         }]
 *     },
 *     templates: {
 *         // loader template
 *         loader: loaderTpl,
 *         // global error template
 *         error: errorTpl,
 *         // xhr status based error messages
 *         status: {
 *             '404': () => errorTpl({
 *                 title: '404',
 *                 message: 'The given page was not found'
 *             }),
 *             '500': () => errorTpl({
 *                 title: '500',
 *                 message: 'An unknown error occurred, please try again later!'
 *             })
 *         }
 *     },
 *     // global event handlers that will be called for each of the pages
 *     handlers: {
 *         select: {
 *             globalSelecthandler(e) {
 *                 let element = e.target;
 *                 let someElementTypeCheck = element.getAttribute('data-my-attribute');
 *
 *                 if (elementTypeCheck) {
 *                     // perform action
 *                 }
 *             }
 *         }
 *     },
 *     onLaunch(options) {
 *         // navigate to menu page
 *         ATV.Navigation.navigateToMenuPage();
 *         // or you can navigate to previously created page
 *         // ATV.Navigation.navigate('login');
 *     }
 * });
 *
 * @inner
 * @alias module:ATV.start
 * @fires onLaunch
 *
 * @param  {Object} cfg 		Configuration options
 */
function start(cfg = {}) {
	if (started) {
		console.warn('Application already started, cannot call start again.');
		return;
	}

    initLibraries(cfg);
	initAppHandlers(cfg);
    // if already bootloaded somewhere
    // immediately call the onLaunch method
    if (cfg.bootloaded) {
        App.onLaunch(App.launchOptions);
    }
	started = true;
}

/**
 * Reloads the application with the provided options and data.
 *
 * @example
 * ATV.reload({when: 'now'}, {customData});
 *
 * @inner
 * @alias module:ATV.reload
 * @fires onReload
 *
 * @param  {Object} [options]           Options value. {when: 'now'} // or 'onResume'
 * @param  {Object} [reloadData]        Custom data that needs to be passed while reloading the app
 */
function reload(options, reloadData) {
    App.onReload(options);
    App.reload(options, reloadData);
}

// add all utility methods
_.assign(libs, PubSub, {
    start: start,
    reload: reload
});

/**
 * Dependency free publish/subscribe for JavaScript.
 * @external pubsub-js
 * @see https://github.com/mroderick/PubSubJS
 */

/**
 * A minimalistic JavaScript SDK for Apple TV application development.
 * It assumes the code is run in an environment where [TVMLKit JS]{@link https://developer.apple.com/documentation/tvmljs} is present (or at least mocked).
 *
 * @module ATV
 * @extends external:pubsub-js
 *
 * @fires onLaunch
 * @fires onError
 * @fires onResume
 * @fires onSuspend
 * @fires onExit
 * @fires onReload
 *
 * @author eMAD &lt;emad.alam@yahoo.com>
 */
module.exports = libs;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jun 21 2018 11:49:21 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
